<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Todo CLI - Terminal-inspired task management">
    <title>{% block title %}Todo CLI{% endblock %}</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', path='/favicon.svg') }}">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="{{ url_for('static', path='/css/variables.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='/css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='/css/components.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='/css/layout.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='/css/todo.css') }}">
    {% block extra_css %}{% endblock %}
    
    <!-- Alpine.js for reactive UI components -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    {% block extra_head %}{% endblock %}
</head>
<body>
    <div class="app" x-data="{ 
        sidebarOpen: window.innerWidth >= 1024,
        commandPaletteOpen: false,
        userMenuOpen: false
    }" @keydown.cmd.k.prevent="commandPaletteOpen = true" @keydown.ctrl.k.prevent="commandPaletteOpen = true">
        
        <!-- Header -->
        <header class="header">
            <div class="header-brand" href="{{ url_for('dashboard') }}">
                <svg class="header-logo" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 11l3 3L22 4"></path>
                    <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"></path>
                </svg>
                <span>Todo CLI</span>
            </div>
            
            <nav class="header-nav">
                <a href="{{ url_for('dashboard') }}" class="header-nav-item {% if request.url.path == url_for('dashboard') %}active{% endif %}">
                    Dashboard
                </a>
                <a href="{{ url_for('tasks') }}" class="header-nav-item {% if request.url.path.startswith('/tasks') %}active{% endif %}">
                    Tasks
                </a>
                <a href="{{ url_for('projects') }}" class="header-nav-item {% if request.url.path.startswith('/projects') %}active{% endif %}">
                    Projects
                </a>
                <a href="{{ url_for('analytics') }}" class="header-nav-item {% if request.url.path.startswith('/analytics') %}active{% endif %}">
                    Analytics
                </a>
            </nav>
            
            <div class="header-actions">
                <!-- Command palette trigger -->
                <button class="btn btn-ghost btn-sm" @click="commandPaletteOpen = true" title="Command Palette (⌘K)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="M21 21l-4.35-4.35"></path>
                    </svg>
                    <span class="text-muted">⌘K</span>
                </button>
                
                <!-- User menu -->
                <div class="user-menu" x-data="{ open: false }" @click.outside="open = false">
                    <div class="user-menu-trigger" @click="open = !open">
                        <div class="user-avatar">
                            {{ current_user.username[0].upper() if current_user else 'U' }}
                        </div>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    
                    <div class="user-menu-dropdown" x-show="open" x-transition style="display: none;">
                        <div class="user-menu-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            <span>Profile</span>
                        </div>
                        <div class="user-menu-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path d="M12 1v6m0 6v6m9-9h-6m-6 0H3"></path>
                            </svg>
                            <span>Settings</span>
                        </div>
                        <div class="user-menu-divider"></div>
                        <div class="user-menu-item" onclick="window.location.href='{{ url_for('logout') }}'">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"></path>
                                <polyline points="16 17 21 12 16 7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                            <span>Logout</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Main layout -->
        <div class="main" style="display: flex;">
            <!-- Sidebar -->
            {% block sidebar %}
            <aside class="sidebar" :class="{ 'open': sidebarOpen }">
                <div class="sidebar-header">
                    <h2 class="sidebar-title">Navigation</h2>
                </div>
                
                <nav class="sidebar-nav">
                    <div class="sidebar-section">
                        <div class="sidebar-section-title">Views</div>
                        <a href="{{ url_for('dashboard') }}" class="sidebar-nav-item {% if request.url.path == url_for('dashboard') %}active{% endif %}">
                            <svg class="sidebar-nav-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="7" height="7"></rect>
                                <rect x="14" y="3" width="7" height="7"></rect>
                                <rect x="14" y="14" width="7" height="7"></rect>
                                <rect x="3" y="14" width="7" height="7"></rect>
                            </svg>
                            <span class="sidebar-nav-item-label">Dashboard</span>
                        </a>
                        <a href="{{ url_for('tasks') }}" class="sidebar-nav-item {% if request.url.path == url_for('tasks') %}active{% endif %}">
                            <svg class="sidebar-nav-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 11l3 3L22 4"></path>
                                <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"></path>
                            </svg>
                            <span class="sidebar-nav-item-label">All Tasks</span>
                            {% if task_count %}
                            <span class="sidebar-nav-item-badge">{{ task_count }}</span>
                            {% endif %}
                        </a>
                        <a href="{{ url_for('tasks_today') }}" class="sidebar-nav-item">
                            <svg class="sidebar-nav-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            <span class="sidebar-nav-item-label">Today</span>
                        </a>
                        <a href="{{ url_for('tasks_upcoming') }}" class="sidebar-nav-item">
                            <svg class="sidebar-nav-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            <span class="sidebar-nav-item-label">Upcoming</span>
                        </a>
                    </div>
                    
                    <div class="sidebar-section">
                        <div class="sidebar-section-title">Projects</div>
                        {% for project in projects[:5] %}
                        <a href="{{ url_for('project_detail', project_id=project.id) }}" class="sidebar-nav-item">
                            <svg class="sidebar-nav-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"></path>
                            </svg>
                            <span class="sidebar-nav-item-label">{{ project.name }}</span>
                        </a>
                        {% endfor %}
                        <a href="{{ url_for('projects') }}" class="sidebar-nav-item text-muted">
                            <span class="sidebar-nav-item-label">View all projects →</span>
                        </a>
                    </div>
                </nav>
            </aside>
            
            <!-- Sidebar overlay for mobile -->
            <div class="sidebar-overlay" x-show="sidebarOpen && window.innerWidth < 1024" @click="sidebarOpen = false" x-transition style="display: none;"></div>
            {% endblock %}
            
            <!-- Main content -->
            <main class="main-content">
                <!-- Flash messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                        <div class="alert alert-{{ category }} animate-slideInDown">
                            <div class="alert-title">{{ category|title }}</div>
                            {{ message }}
                        </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
                
                {% block content %}{% endblock %}
            </main>
        </div>
        
        <!-- Command Palette -->
        <div x-show="commandPaletteOpen" x-transition style="display: none;">
            <div class="command-palette-backdrop" @click="commandPaletteOpen = false"></div>
            <div class="command-palette" @click.outside="commandPaletteOpen = false">
                <input type="text" class="command-palette-input" placeholder="Type a command or search..." autofocus
                    @keydown.escape="commandPaletteOpen = false">
                
                <div class="command-palette-results">
                    <div class="command-palette-item selected">
                        <svg class="command-palette-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        <div class="command-palette-item-content">
                            <div class="command-palette-item-title">Create new task</div>
                            <div class="command-palette-item-subtitle">Add a new task to your list</div>
                        </div>
                        <span class="command-palette-item-shortcut">⌘N</span>
                    </div>
                    <!-- More command items will be populated dynamically -->
                </div>
                
                <div class="command-palette-footer">
                    <div class="command-palette-hint">
                        <span class="command-palette-hint-key">↑↓</span>
                        <span>Navigate</span>
                    </div>
                    <div class="command-palette-hint">
                        <span class="command-palette-hint-key">↵</span>
                        <span>Select</span>
                    </div>
                    <div class="command-palette-hint">
                        <span class="command-palette-hint-key">Esc</span>
                        <span>Close</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script>
        // Global keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Command/Ctrl + K for command palette (handled by Alpine)
            // Add more global shortcuts here
        });
        
        // Service worker for offline support (optional)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').catch(() => {
                    // Service worker registration failed, app will work without offline support
                });
            });
        }
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>
